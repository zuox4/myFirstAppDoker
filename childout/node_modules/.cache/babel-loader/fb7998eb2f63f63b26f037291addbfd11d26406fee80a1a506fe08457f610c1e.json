{"ast":null,"code":"import'./PagesStyle.css';import ListChildCard from\"../components/ListChildCard\";import ModalWindow from\"../components/ModalWindow\";import React,{useContext,useEffect,useState}from\"react\";import io from\"socket.io-client\";import axios from\"axios\";import{UserId}from\"../App\";import{useOutletContext}from\"react-router-dom\";import{api_url}from\"../api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(api_url);// URL вашего сервера\nfunction ClientPanel(){const[message,setMessage]=useState('');const[modal,setModal]=React.useState(false);const[activeChildCardName,setActiveChildCard]=React.useState({fullName:'',id:'',numberPhone:'',birthDate:''});const[className,dataStudents,isLoading]=useOutletContext();const[dateOut,setDateOut]=React.useState(Date.now());const{user}=useContext(UserId);function parseDate(dateString){if(dateString.endsWith('Z')){dateString=dateString.slice(0,-1);}const[datePart,timePart]=dateString.split('T');const[year,month,day]=datePart.split('-').map(Number);const[hours,minutes]=timePart.split(':').map(Number);const date=new Date(Date.UTC(year,month-1,day,hours,minutes));return date;}const sendMessage=()=>{// Отправляем сообщение на сервер\nsocket.emit('client-message',message);fix(user.id,parseDate(dateOut)).then(r=>alert('Пропуск успешно оформлен')).catch(e=>alert('Произошла ошибка'));console.log(parseDate(dateOut));setMessage('');};const fix=async(teacherId,date_out)=>{const studentId=activeChildCardName.id;try{const response=await axios.post(`/fix_out`,{mentor_id:teacherId,student_id:studentId,date_out:date_out});console.log(response.data);return response.data;}catch(er){console.log(er);}};return!isLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"main-page\",children:[/*#__PURE__*/_jsx(ListChildCard,{dataStudents:dataStudents,setModal:setModal,setActiveChildCard:setActiveChildCard,activeChildCardName:activeChildCardName}),/*#__PURE__*/_jsx(ModalWindow,{setDateOut:setDateOut,sendMessage:sendMessage,setMessage:setMessage,isOpen:modal,setModal:setModal,setActiveChildCard:setActiveChildCard,className:className,fullName:activeChildCardName.fullName,id:activeChildCardName.id})]});}export default ClientPanel;","map":{"version":3,"names":["ListChildCard","ModalWindow","React","useContext","useEffect","useState","io","axios","UserId","useOutletContext","api_url","jsx","_jsx","jsxs","_jsxs","socket","ClientPanel","message","setMessage","modal","setModal","activeChildCardName","setActiveChildCard","fullName","id","numberPhone","birthDate","className","dataStudents","isLoading","dateOut","setDateOut","Date","now","user","parseDate","dateString","endsWith","slice","datePart","timePart","split","year","month","day","map","Number","hours","minutes","date","UTC","sendMessage","emit","fix","then","r","alert","catch","e","console","log","teacherId","date_out","studentId","response","post","mentor_id","student_id","data","er","children","isOpen"],"sources":["C:/Users/kir/WebstormProjects/childout/src/pages/ClientPanel.js"],"sourcesContent":["import './PagesStyle.css'\r\n\r\nimport ListChildCard from \"../components/ListChildCard\";\r\nimport ModalWindow from \"../components/ModalWindow\";\r\nimport React, {useContext, useEffect, useState} from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport axios from \"axios\";\r\nimport {UserId} from \"../App\";\r\nimport {useOutletContext} from \"react-router-dom\";\r\nimport {api_url} from \"../api\";\r\n\r\n\r\nconst socket = io(api_url); // URL вашего сервера\r\n\r\nfunction ClientPanel() {\r\n    const [message, setMessage] = useState('');\r\n    const [modal, setModal] = React.useState(false);\r\n    const [activeChildCardName, setActiveChildCard] = React.useState({fullName:'', id:'', numberPhone:'', birthDate:''});\r\n    const [className, dataStudents, isLoading] = useOutletContext()\r\n    const [dateOut, setDateOut] = React.useState(Date.now());\r\n    const { user } = useContext(UserId);\r\n    function parseDate(dateString) {\r\n\r\n        if (dateString.endsWith('Z')) {\r\n            dateString = dateString.slice(0, -1);\r\n        }\r\n        const [datePart, timePart] = dateString.split('T');\r\n        const [year, month, day] = datePart.split('-').map(Number);\r\n        const [hours, minutes] = timePart.split(':').map(Number);\r\n        const date = new Date(Date.UTC(year, month - 1, day, hours, minutes));\r\n        return date;\r\n    }\r\n\r\n\r\n    const sendMessage = () => {\r\n        // Отправляем сообщение на сервер\r\n        socket.emit('client-message', message);\r\n        fix(user.id, parseDate(dateOut)).then(r => alert('Пропуск успешно оформлен')).catch(e => alert('Произошла ошибка'));\r\n        console.log(parseDate(dateOut))\r\n        setMessage('');\r\n    };\r\n\r\n\r\n        const fix = async (teacherId, date_out) => {\r\n            const studentId = activeChildCardName.id;\r\n            try {\r\n                const response = await axios.post(`/fix_out`, { mentor_id:teacherId, student_id:studentId, date_out:date_out});\r\n                console.log(response.data)\r\n                return response.data;\r\n            }catch (er){\r\n                console.log(er);\r\n            }\r\n    }\r\n\r\n    return(\r\n        !isLoading&&<div className=\"main-page\">\r\n            {<ListChildCard dataStudents={dataStudents} setModal={setModal} setActiveChildCard={setActiveChildCard} activeChildCardName={activeChildCardName} />}\r\n            <ModalWindow setDateOut={setDateOut} sendMessage={sendMessage} setMessage={setMessage} isOpen={modal} setModal={setModal} setActiveChildCard={setActiveChildCard} className={className} fullName={activeChildCardName.fullName} id={activeChildCardName.id}  />\r\n        </div>\r\n    )\r\n}\r\nexport default ClientPanel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}